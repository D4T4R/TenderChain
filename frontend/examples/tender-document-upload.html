<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <title>Tender Document Upload - Tenders 2.0</title>\n    <meta content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\" name=\"viewport\">\n    \n    <!-- Bootstrap core CSS -->\n    <link href=\"../assets/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <!-- Material Dashboard CSS -->\n    <link href=\"../assets/css/material-dashboard.css\" rel=\"stylesheet\">\n    <!-- Material Icons -->\n    <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n    \n    <style>\n        .upload-area {\n            border: 2px dashed #ccc;\n            border-radius: 10px;\n            padding: 50px;\n            text-align: center;\n            margin: 20px 0;\n            transition: border-color 0.3s ease;\n        }\n        \n        .upload-area.drag-over {\n            border-color: #007bff;\n            background-color: #f8f9fa;\n        }\n        \n        .upload-area i {\n            font-size: 48px;\n            color: #6c757d;\n            margin-bottom: 20px;\n        }\n        \n        .upload-progress {\n            display: none;\n            margin-top: 20px;\n        }\n        \n        .summary-result {\n            background: #f8f9fa;\n            border-radius: 5px;\n            padding: 20px;\n            margin-top: 20px;\n            display: none;\n        }\n        \n        .confidence-high { color: #28a745; }\n        .confidence-medium { color: #ffc107; }\n        .confidence-low { color: #dc3545; }\n    </style>\n</head>\n\n<body>\n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <div class=\"col-md-12\">\n                <div class=\"card\">\n                    <div class=\"card-header card-header-primary\">\n                        <h3 class=\"card-title\">Upload Tender Document</h3>\n                        <p class=\"card-category\">Upload PDF/Word documents to automatically generate tender summaries</p>\n                    </div>\n                    <div class=\"card-body\">\n                        <form id=\"uploadForm\" enctype=\"multipart/form-data\">\n                            <!-- Basic Information -->\n                            <div class=\"row\">\n                                <div class=\"col-md-6\">\n                                    <div class=\"form-group\">\n                                        <label class=\"bmd-label-floating\">Tender ID</label>\n                                        <input type=\"text\" class=\"form-control\" id=\"tenderId\" name=\"tenderId\" required>\n                                    </div>\n                                </div>\n                                <div class=\"col-md-6\">\n                                    <div class=\"form-group\">\n                                        <label class=\"bmd-label-floating\">Tender Contract Address</label>\n                                        <input type=\"text\" class=\"form-control\" id=\"tenderAddress\" name=\"tenderAddress\" required placeholder=\"0x...\">\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class=\"row\">\n                                <div class=\"col-md-6\">\n                                    <div class=\"form-group\">\n                                        <label class=\"bmd-label-floating\">Government Officer Address</label>\n                                        <input type=\"text\" class=\"form-control\" id=\"uploaderAddress\" name=\"uploaderAddress\" required placeholder=\"0x...\">\n                                    </div>\n                                </div>\n                                <div class=\"col-md-6\">\n                                    <div class=\"form-group\">\n                                        <label class=\"bmd-label-static\">Processing Mode</label>\n                                        <select class=\"form-control\" id=\"processAsync\" name=\"processAsync\">\n                                            <option value=\"false\">Process Immediately</option>\n                                            <option value=\"true\">Process in Background</option>\n                                        </select>\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <!-- File Upload Area -->\n                            <div class=\"upload-area\" id=\"uploadArea\">\n                                <i class=\"material-icons\">cloud_upload</i>\n                                <h4>Drop your tender document here</h4>\n                                <p>Supports PDF, Word (.doc, .docx), and Text files</p>\n                                <p>Maximum file size: 10MB</p>\n                                <input type=\"file\" id=\"documentFile\" name=\"document\" accept=\".pdf,.doc,.docx,.txt\" style=\"display: none;\" required>\n                                <button type=\"button\" class=\"btn btn-primary\" onclick=\"document.getElementById('documentFile').click()\">\n                                    <i class=\"material-icons\">folder_open</i> Choose File\n                                </button>\n                            </div>\n                            \n                            <!-- Selected File Info -->\n                            <div id=\"fileInfo\" style=\"display: none;\">\n                                <div class=\"alert alert-info\">\n                                    <strong>Selected File:</strong> <span id=\"fileName\"></span>\n                                    <br><strong>Size:</strong> <span id=\"fileSize\"></span>\n                                    <br><strong>Type:</strong> <span id=\"fileType\"></span>\n                                </div>\n                            </div>\n                            \n                            <!-- Upload Progress -->\n                            <div class=\"upload-progress\">\n                                <div class=\"progress\">\n                                    <div class=\"progress-bar progress-bar-striped progress-bar-animated\" role=\"progressbar\" style=\"width: 0%\"></div>\n                                </div>\n                                <p class=\"text-center mt-2\">Processing document...</p>\n                            </div>\n                            \n                            <!-- Action Buttons -->\n                            <div class=\"text-center mt-4\">\n                                <button type=\"submit\" class=\"btn btn-success btn-lg\" id=\"submitBtn\">\n                                    <i class=\"material-icons\">upload</i> Upload & Process Document\n                                </button>\n                                <button type=\"button\" class=\"btn btn-secondary ml-2\" onclick=\"resetForm()\">\n                                    <i class=\"material-icons\">clear</i> Reset\n                                </button>\n                            </div>\n                        </form>\n                        \n                        <!-- Processing Result -->\n                        <div id=\"processingResult\" class=\"summary-result\">\n                            <h4><i class=\"material-icons\">check_circle</i> Document Processed Successfully</h4>\n                            <div id=\"summaryContent\"></div>\n                        </div>\n                        \n                        <!-- Error Messages -->\n                        <div id=\"errorAlert\" class=\"alert alert-danger\" style=\"display: none;\">\n                            <strong>Error:</strong> <span id=\"errorMessage\"></span>\n                        </div>\n                    </div>\n                </div>\n                \n                <!-- Instructions Card -->\n                <div class=\"card\">\n                    <div class=\"card-header card-header-info\">\n                        <h4 class=\"card-title\">How it Works</h4>\n                    </div>\n                    <div class=\"card-body\">\n                        <div class=\"row\">\n                            <div class=\"col-md-3 text-center\">\n                                <i class=\"material-icons\" style=\"font-size: 48px; color: #17a2b8;\">description</i>\n                                <h5>1. Upload Document</h5>\n                                <p>Upload your tender document (PDF, Word, or Text format)</p>\n                            </div>\n                            <div class=\"col-md-3 text-center\">\n                                <i class=\"material-icons\" style=\"font-size: 48px; color: #28a745;\">smart_toy</i>\n                                <h5>2. AI Processing</h5>\n                                <p>Our NLP engine extracts key information and work details</p>\n                            </div>\n                            <div class=\"col-md-3 text-center\">\n                                <i class=\"material-icons\" style=\"font-size: 48px; color: #ffc107;\">summarize</i>\n                                <h5>3. Generate Summary</h5>\n                                <p>Automatic summary generation with confidence scoring</p>\n                            </div>\n                            <div class=\"col-md-3 text-center\">\n                                <i class=\"material-icons\" style=\"font-size: 48px; color: #6f42c1;\">public</i>\n                                <h5>4. Public Display</h5>\n                                <p>Summary appears on public dashboard for transparency</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Scripts -->\n    <script src=\"../assets/js/jquery-3.2.1.min.js\"></script>\n    <script src=\"../assets/js/bootstrap.min.js\"></script>\n    <script src=\"../assets/js/material-dashboard.js\"></script>\n    \n    <script>\n        let selectedFile = null;\n        \n        // File upload handling\n        document.getElementById('documentFile').addEventListener('change', function(e) {\n            const file = e.target.files[0];\n            if (file) {\n                handleFileSelection(file);\n            }\n        });\n        \n        // Drag and drop functionality\n        const uploadArea = document.getElementById('uploadArea');\n        \n        uploadArea.addEventListener('dragover', function(e) {\n            e.preventDefault();\n            uploadArea.classList.add('drag-over');\n        });\n        \n        uploadArea.addEventListener('dragleave', function(e) {\n            e.preventDefault();\n            uploadArea.classList.remove('drag-over');\n        });\n        \n        uploadArea.addEventListener('drop', function(e) {\n            e.preventDefault();\n            uploadArea.classList.remove('drag-over');\n            \n            const files = e.dataTransfer.files;\n            if (files.length > 0) {\n                const file = files[0];\n                document.getElementById('documentFile').files = files;\n                handleFileSelection(file);\n            }\n        });\n        \n        function handleFileSelection(file) {\n            selectedFile = file;\n            \n            // Validate file type\n            const allowedTypes = ['application/pdf', 'application/msword', \n                                'application/vnd.openxmlformats-officedocument.wordprocessingml.document', \n                                'text/plain'];\n            \n            if (!allowedTypes.includes(file.type)) {\n                showError('Please select a valid file type (PDF, Word, or Text)');\n                return;\n            }\n            \n            // Validate file size (10MB limit)\n            if (file.size > 10 * 1024 * 1024) {\n                showError('File size must be less than 10MB');\n                return;\n            }\n            \n            // Display file info\n            document.getElementById('fileName').textContent = file.name;\n            document.getElementById('fileSize').textContent = formatFileSize(file.size);\n            document.getElementById('fileType').textContent = file.type;\n            document.getElementById('fileInfo').style.display = 'block';\n            \n            hideError();\n        }\n        \n        // Form submission\n        document.getElementById('uploadForm').addEventListener('submit', async function(e) {\n            e.preventDefault();\n            \n            if (!selectedFile) {\n                showError('Please select a file to upload');\n                return;\n            }\n            \n            const formData = new FormData();\n            formData.append('document', selectedFile);\n            formData.append('tenderId', document.getElementById('tenderId').value);\n            formData.append('tenderAddress', document.getElementById('tenderAddress').value);\n            formData.append('uploaderAddress', document.getElementById('uploaderAddress').value);\n            formData.append('processAsync', document.getElementById('processAsync').value);\n            \n            // Show progress\n            showProgress();\n            document.getElementById('submitBtn').disabled = true;\n            \n            try {\n                const response = await fetch('http://localhost:3001/api/files/upload-tender-document', {\n                    method: 'POST',\n                    body: formData\n                });\n                \n                const result = await response.json();\n                \n                if (response.ok) {\n                    if (result.summary) {\n                        // Immediate processing result\n                        showResult(result);\n                    } else {\n                        // Background processing\n                        showBackgroundProcessingResult(result);\n                    }\n                } else {\n                    showError(result.error || 'Upload failed');\n                }\n            } catch (error) {\n                console.error('Upload error:', error);\n                showError('Network error: ' + error.message);\n            } finally {\n                hideProgress();\n                document.getElementById('submitBtn').disabled = false;\n            }\n        });\n        \n        function showProgress() {\n            document.querySelector('.upload-progress').style.display = 'block';\n            let progress = 0;\n            const progressBar = document.querySelector('.progress-bar');\n            \n            const interval = setInterval(() => {\n                progress += 10;\n                progressBar.style.width = progress + '%';\n                \n                if (progress >= 90) {\n                    clearInterval(interval);\n                }\n            }, 200);\n        }\n        \n        function hideProgress() {\n            document.querySelector('.upload-progress').style.display = 'none';\n            document.querySelector('.progress-bar').style.width = '0%';\n        }\n        \n        function showResult(result) {\n            const summary = result.summary;\n            const confidence = summary.summary.confidence;\n            \n            let confidenceClass = 'confidence-low';\n            if (confidence >= 80) confidenceClass = 'confidence-high';\n            else if (confidence >= 60) confidenceClass = 'confidence-medium';\n            \n            const summaryHtml = `\n                <div class=\"row\">\n                    <div class=\"col-md-6\">\n                        <h5>Extracted Information</h5>\n                        <ul class=\"list-unstyled\">\n                            <li><strong>Work Type:</strong> ${summary.summary.workType}</li>\n                            <li><strong>Location:</strong> ${summary.summary.location}</li>\n                            <li><strong>Estimated Value:</strong> ${summary.summary.estimatedValue}</li>\n                            <li><strong>Timeline:</strong> ${summary.summary.timeline}</li>\n                            <li><strong>Confidence:</strong> <span class=\"${confidenceClass}\">${confidence}%</span></li>\n                        </ul>\n                    </div>\n                    <div class=\"col-md-6\">\n                        <h5>Key Requirements</h5>\n                        ${summary.summary.keyRequirements.length > 0 ? \n                            '<ul>' + summary.summary.keyRequirements.map(req => `<li>${req}</li>`).join('') + '</ul>' :\n                            '<p class=\"text-muted\">No specific requirements extracted</p>'\n                        }\n                    </div>\n                </div>\n                <div class=\"mt-3\">\n                    <h5>Project Overview</h5>\n                    <p class=\"bg-light p-3 rounded\">${summary.summary.overview}</p>\n                </div>\n                <div class=\"mt-3\">\n                    <h5>Project Scope</h5>\n                    <p class=\"bg-light p-3 rounded\">${summary.summary.projectScope}</p>\n                </div>\n                <div class=\"text-center mt-3\">\n                    <small class=\"text-muted\">Processing completed in ${result.processingTime}</small>\n                </div>\n            `;\n            \n            document.getElementById('summaryContent').innerHTML = summaryHtml;\n            document.getElementById('processingResult').style.display = 'block';\n        }\n        \n        function showBackgroundProcessingResult(result) {\n            const summaryHtml = `\n                <div class=\"text-center\">\n                    <i class=\"material-icons\" style=\"font-size: 48px; color: #17a2b8;\">hourglass_empty</i>\n                    <h5>Document Queued for Processing</h5>\n                    <p>Your document has been uploaded and queued for background processing.</p>\n                    <p><strong>Job ID:</strong> <code>${result.jobId}</code></p>\n                    <p>You can check the processing status using the job ID above.</p>\n                    <button class=\"btn btn-info\" onclick=\"checkJobStatus('${result.jobId}')\">\n                        <i class=\"material-icons\">refresh</i> Check Status\n                    </button>\n                </div>\n            `;\n            \n            document.getElementById('summaryContent').innerHTML = summaryHtml;\n            document.getElementById('processingResult').style.display = 'block';\n        }\n        \n        async function checkJobStatus(jobId) {\n            try {\n                const response = await fetch(`http://localhost:3001/api/files/job-status/${jobId}`);\n                const status = await response.json();\n                \n                alert(`Job Status: ${status.state}\\nProgress: ${status.progress}%`);\n            } catch (error) {\n                alert('Error checking job status: ' + error.message);\n            }\n        }\n        \n        function showError(message) {\n            document.getElementById('errorMessage').textContent = message;\n            document.getElementById('errorAlert').style.display = 'block';\n        }\n        \n        function hideError() {\n            document.getElementById('errorAlert').style.display = 'none';\n        }\n        \n        function formatFileSize(bytes) {\n            if (bytes === 0) return '0 Bytes';\n            const k = 1024;\n            const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n            const i = Math.floor(Math.log(bytes) / Math.log(k));\n            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n        }\n        \n        function resetForm() {\n            document.getElementById('uploadForm').reset();\n            document.getElementById('fileInfo').style.display = 'none';\n            document.getElementById('processingResult').style.display = 'none';\n            hideError();\n            hideProgress();\n            selectedFile = null;\n        }\n    </script>\n</body>\n</html>"
